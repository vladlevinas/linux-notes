name: TLDR → Notes (3x daily, Linux + Common)

permissions:
  contents: write

on:
  schedule:
    # Время UTC — для Вильнюса (UTC+2 зимой, +3 летом)
    # значит 09:00, 15:00, 21:00 Вильнюс = 07:00, 13:00, 19:00 UTC
    - cron: "0 7,13,19 * * *"
  workflow_dispatch: {}  # можно запустить вручную

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Ensure state and file list
        run: |
          set -euxo pipefail
          mkdir -p .state notes
          [ -f .state/idx ] || echo 1 > .state/idx

          # если нет списка, создаём объединённый (linux + common)
          if [ ! -s .state/files.list ]; then
            echo "Building combined file list..."
            find vendor/tldr/pages/linux  -type f -name '*.md' > /tmp/linux.txt  || true
            find vendor/tldr/pages/common -type f -name '*.md' > /tmp/common.txt || true
            cat /tmp/linux.txt /tmp/common.txt | awk -F/ '{print $NF "|" $0}' | sort -f | cut -d"|" -f2 > .state/files.list
            echo "Total TLDR files: $(wc -l < .
